<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>SVI Calculation for Custom Geographic Boundaries • findSVI</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="SVI Calculation for Custom Geographic Boundaries">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">findSVI</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/findSVI.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/custom_geo.html">SVI Calculation for Custom Geographic Boundaries</a></li>
    <li><a class="dropdown-item" href="../articles/geo_context_of_svi.html">Geographic Context of SVI</a></li>
    <li><a class="dropdown-item" href="../articles/svi-covid.html">SVI and Health Outcome</a></li>
    <li><a class="dropdown-item" href="../articles/SVI-mapping.html">Mapping SVI for Spatial Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/svi-validation.html">Validation of SVI results</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/heli-xu/findSVI/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>SVI Calculation for Custom Geographic Boundaries</h1>
            <h3 data-toc-skip class="subtitle">An example using US
commuting zones for 2020</h3>
            
      
      <small class="dont-index">Source: <a href="https://github.com/heli-xu/findSVI/blob/main/vignettes/articles/custom_geo.Rmd" class="external-link"><code>vignettes/articles/custom_geo.Rmd</code></a></small>
      <div class="d-none name"><code>custom_geo.Rmd</code></div>
    </div>

    
    
<p>The findSVI package originally calculated SVI at standard Census
geographic levels, with data retrieval and SVI calculations performed at
the same level. We’ve recently expanded the functionality of the package
to support SVI calculations for custom geographic boundaries in which
the Census geographies are fully nested.</p>
<p>Here we are using commuting zones as an example to demonstrate the
new feature to support user-defined boundaries for SVI calculation.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/heli-xu/findSVI" class="external-link">findSVI</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://wilkelab.org/cowplot/" class="external-link">cowplot</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://stringr.tidyverse.org" class="external-link">stringr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://readr.tidyverse.org" class="external-link">readr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="commuting-zones">Commuting zones<a class="anchor" aria-label="anchor" href="#commuting-zones"></a>
</h2>
<p>First proposed by <a href="https://scholar.google.com/scholar_lookup?&amp;title=Labor%20market%20areas%20for%20the%20United%20States&amp;publication_year=1987&amp;author=Tolbert%2CC&amp;author=Killian%2CM" class="external-link">Tolbert
and Killian in 1987</a> and updated by <a href="https://link.springer.com/article/10.1007/s11113-016-9386-0#ref-CR32" class="external-link">Fowler,
Jensen and Rhubart in 2016</a>, commuting zones (CZs) offer a geographic
delineation to understand regional labor market, taking into account the
commuter flow data and American Community Survey (ACS) data.</p>
<p>Geographically, CZs are based on counties (i.e., counties are fully
nested in CZs) and cover the entire US. Therefore, to calculate SVI for
CZs, we can retrieve the data at the county level and use a crosswalk to
combine the counties to CZs level.</p>
</div>
<div class="section level2">
<h2 id="workflow">Workflow<a class="anchor" aria-label="anchor" href="#workflow"></a>
</h2>
<div class="section level3">
<h3 id="set-up-a-crosswalk">Set up a crosswalk<a class="anchor" aria-label="anchor" href="#set-up-a-crosswalk"></a>
</h3>
<p>In addition to the year and region of interest for SVI calculation,
we need to supply a user-defined crosswalk (relationship file) between
the Census geography and customized geography. For example, the
crosswalk between CZ and county for 2020 is downloaded from <a href="https://sites.psu.edu/psucz/" class="external-link">the Penn State Commuting Zones /
Labor Markets data repository</a>, and modified to keep only the IDs for
counties and CZs. The resulting table <code>cty_cz_2020_xwalk</code> is
stored in the package as an example and a template for the crosswalk.
Note that the crosswalk should be a data frame, with column names
<code>GEOID</code> representing the Census geography (county) and
<code>GEOID2</code> representing the user-defined geography (CZ).
<code>GEOID</code> should be completed nested in <code>GEOID2</code> so
that the census data can be accurately aggregated to the customized
geographic level.</p>
<p>Optionally, the crosswalk can include another column
<code>NAME</code> for the description or name of the user-defined
geography, which will be included in the final SVI output.</p>
</div>
<div class="section level3">
<h3 id="find_svi_x">
<code>find_svi_x()</code><a class="anchor" aria-label="anchor" href="#find_svi_x"></a>
</h3>
<p>To obtain SVI <em>with geometries</em> for CZs in the US for 2020, we
can use <code><a href="../reference/find_svi_x.html">find_svi_x()</a></code> to retrieve nation-level census data,
aggregate to CZ level, and calculate CZ-level SVIs.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cz_svi_geo</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/find_svi_x.html">find_svi_x</a></span><span class="op">(</span></span>
<span>  year <span class="op">=</span> <span class="fl">2020</span>,</span>
<span>  geography <span class="op">=</span> <span class="st">"county"</span>,</span>
<span>  xwalk <span class="op">=</span> <span class="va">cty_cz_2020_xwalk</span>, <span class="co">#county-commuting zone crosswalk</span></span>
<span>  geometry <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Alternatively, we can separate the data retrieval and SVI calculation
for more fine-tuning action, via <code><a href="../reference/get_census_data.html">get_census_data()</a></code> with
<code>exp=TRUE</code> and <code><a href="../reference/get_svi_x.html">get_svi_x()</a></code></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_geo</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_census_data.html">get_census_data</a></span><span class="op">(</span></span>
<span>  year <span class="op">=</span> <span class="fl">2020</span>, </span>
<span>  geography <span class="op">=</span> <span class="st">"county"</span>,</span>
<span>  geometry <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  exp <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">svi_geo</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_svi_x.html">get_svi_x</a></span><span class="op">(</span></span>
<span>  year <span class="op">=</span> <span class="fl">2020</span>,</span>
<span>  data <span class="op">=</span> <span class="va">data_geo</span>,</span>
<span>  xwalk <span class="op">=</span> <span class="va">cty_cz_2020_xwalk</span> <span class="co">#county-commuting zone crosswalk</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>To visualize the overall SVI for each CZ in the US (the higher the
SVI, the more vulnerable a community is considered):</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">continent</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">svi_geo</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">RPL_themes</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">coord_sf</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">130</span>, <span class="op">-</span><span class="fl">60</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">23</span>, <span class="fl">50</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>  </span>
<span>  <span class="co"># Adjust xlim and ylim to focus on continental US</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_c</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"inferno"</span>, direction <span class="op">=</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Social Vulnerability Index of US Commuting Zones (2020)"</span>,</span>
<span>    caption <span class="op">=</span> <span class="st">"Data source: Census ACS and https://sites.psu.edu/psucz/"</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"Overall SVI"</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span>, hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>    plot.caption <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">8</span><span class="op">)</span>,</span>
<span>    axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    panel.grid <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    legend.key.size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="st">"cm"</span><span class="op">)</span>,</span>
<span>    legend.position <span class="op">=</span> <span class="st">"inside"</span>,</span>
<span>    legend.position.inside <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.9</span>, <span class="fl">0.3</span><span class="op">)</span>,</span>
<span>    legend.frame <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"white"</span>, linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>    <span class="co">#legend.background = element_rect(color = "black"),</span></span>
<span>    legend.box.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span>,</span>
<span>    legend.box.margin <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">margin</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">3</span>,<span class="fl">0</span>, unit <span class="op">=</span> <span class="st">"mm"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co">#Alaska</span></span>
<span><span class="va">inset_ak</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">svi_geo</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">RPL_themes</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">coord_sf</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">179.5</span>,<span class="op">-</span><span class="fl">130</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">51.2</span>, <span class="fl">71.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_c</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"inferno"</span>, direction <span class="op">=</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    panel.grid <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    legend.position <span class="op">=</span> <span class="st">"none"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co">#Hawaii</span></span>
<span><span class="va">inset_hi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">svi_geo</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">RPL_themes</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">coord_sf</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">178.3</span>, <span class="op">-</span><span class="fl">154.8</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">18.9</span>, <span class="fl">28.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>  </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_c</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"inferno"</span>, direction <span class="op">=</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    panel.grid <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    legend.position <span class="op">=</span> <span class="st">"none"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/ggdraw.html" class="external-link">ggdraw</a></span><span class="op">(</span><span class="va">continent</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://wilkelab.org/cowplot/reference/draw_plot.html" class="external-link">draw_plot</a></span><span class="op">(</span><span class="va">inset_ak</span>, <span class="op">-</span><span class="fl">0.3</span>, <span class="op">-</span><span class="fl">0.3</span>, scale <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://wilkelab.org/cowplot/reference/draw_plot.html" class="external-link">draw_plot</a></span><span class="op">(</span><span class="va">inset_hi</span>, <span class="op">-</span><span class="fl">0.2</span>, <span class="op">-</span><span class="fl">0.3</span>, scale <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span></span></code></pre></div>
<p><img src="images%2FSVI_CZ_map.jpg"></p>
<p>If spatial information is not needed, we can leave out the
<code>geometry</code> argument (<code>geometry = FALSE</code> is
default) in <code><a href="../reference/find_svi_x.html">find_svi_x()</a></code> or <code><a href="../reference/get_census_data.html">get_census_data()</a></code>
to obtain only the SVI variables.</p>
</div>
</div>
<div class="section level2">
<h2 id="validation">Validation<a class="anchor" aria-label="anchor" href="#validation"></a>
</h2>
<p>In <a href="svi-validation.html">Validation of SVI results</a>, we
have documented the comparison between SVI results from findSVI and CDC
database in standard operation. To validate the modified variable list
and the calculation table when <code>exp=TRUE</code>, we’ll use a
pseudo-crosswalk with replicating the county IDs (county-county
crosswalk) and compare the results from <code><a href="../reference/find_svi_x.html">find_svi_x()</a></code> with
CDC SVI.</p>
<p>The first 10 rows of the pseudo-crosswalk look like this:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ps_xwalk</span> <span class="op">&lt;-</span> <span class="va">cty_cz_2020_xwalk</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">GEOID</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>GEOID2 <span class="op">=</span> <span class="va">GEOID</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ps_xwalk</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt;    GEOID GEOID2</span></span>
<span><span class="co">#&gt; 1  01069  01069</span></span>
<span><span class="co">#&gt; 2  01023  01023</span></span>
<span><span class="co">#&gt; 3  01005  01005</span></span>
<span><span class="co">#&gt; 4  01107  01107</span></span>
<span><span class="co">#&gt; 5  01033  01033</span></span>
<span><span class="co">#&gt; 6  04012  04012</span></span>
<span><span class="co">#&gt; 7  04001  04001</span></span>
<span><span class="co">#&gt; 8  05081  05081</span></span>
<span><span class="co">#&gt; 9  05121  05121</span></span>
<span><span class="co">#&gt; 10 06037  06037</span></span></code></pre></div>
<p>Supplying the crosswalk to <code><a href="../reference/find_svi_x.html">find_svi_x()</a></code>, we are
“aggregating” each county to itself, producing county-level SVIs for
comparison with CDC SVI. The main goal is to validate that our modified
variable calculations using explicit denominators for percent estimates
produce results consistent with the CDC database.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pa_cty_svi_x2020</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/find_svi_x.html">find_svi_x</a></span><span class="op">(</span></span>
<span>  year <span class="op">=</span> <span class="fl">2020</span>,</span>
<span>  geography <span class="op">=</span> <span class="st">"county"</span>,</span>
<span>  state <span class="op">=</span> <span class="st">"PA"</span>,</span>
<span>  xwalk <span class="op">=</span> <span class="va">ps_xwalk</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Now we are ready to compare this result with CDC’s county-level SVI
for PA for 2020 downloaded from <a href="https://www.atsdr.cdc.gov/placeandhealth/svi/data_documentation_download.html" class="external-link">CDC/ATSDR
SVI data</a></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"testdata"</span>,<span class="st">"cdc_pa_cty_svi2020.rda"</span>,package <span class="op">=</span> <span class="st">"findSVI"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#FIPS renamed to GEOID </span></span>
<span></span>
<span><span class="va">join_RPL</span> <span class="op">&lt;-</span> <span class="va">cdc_pa_cty_svi2020</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">GEOID</span>,</span>
<span>      cdc_RPL_themes <span class="op">=</span> <span class="va">RPL_THEMES</span>,</span>
<span>      cdc_RPL_theme1 <span class="op">=</span> <span class="va">RPL_THEME1</span>,</span>
<span>      cdc_RPL_theme2 <span class="op">=</span> <span class="va">RPL_THEME2</span>,</span>
<span>      cdc_RPL_theme3 <span class="op">=</span> <span class="va">RPL_THEME3</span>,</span>
<span>      cdc_RPL_theme4 <span class="op">=</span> <span class="va">RPL_THEME4</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>GEOID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">GEOID</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">pa_cty_svi_x2020</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">GEOID</span>,</span>
<span>          <span class="va">RPL_themes</span>,</span>
<span>          <span class="va">RPL_theme1</span>,</span>
<span>          <span class="va">RPL_theme2</span>,</span>
<span>          <span class="va">RPL_theme3</span>,</span>
<span>          <span class="va">RPL_theme4</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html" class="external-link">drop_na</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>   <span class="co">## remove NA rows</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter_all.html" class="external-link">filter_all</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/all_vars.html" class="external-link">all_vars</a></span><span class="op">(</span><span class="va">.</span> <span class="op">&gt;=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="co">#-999 in cdc data</span></span>
<span><span class="co">#&gt; Joining with `by = join_by(GEOID)`</span></span>
<span></span>
<span><span class="va">coeff</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">join_RPL</span><span class="op">$</span><span class="va">cdc_RPL_themes</span>, <span class="va">join_RPL</span><span class="op">$</span><span class="va">RPL_themes</span><span class="op">)</span></span>
<span></span>
<span><span class="va">join_RPL</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">cdc_RPL_themes</span>, y <span class="op">=</span> <span class="va">RPL_themes</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"#004C54"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_abline</a></span><span class="op">(</span>slope <span class="op">=</span> <span class="fl">1</span>, intercept <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"CDC vs. find_svi_x() county-level SVI for PA, 2020"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Comparison of overall percentile rankings (RPLs), correlation coefficient = "</span>, <span class="va">coeff</span><span class="op">)</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"find_svi_x()"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"CDC"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span> <span class="fl">14</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="custom_geo_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="appendix-mapping-svi-percentage-variables-to-census-variables">Appendix: mapping SVI (percentage) variables to census
variables<a class="anchor" aria-label="anchor" href="#appendix-mapping-svi-percentage-variables-to-census-variables"></a>
</h2>
<p>Currently, the variable retrieval process by
<code><a href="../reference/get_census_data.html">get_census_data()</a></code> follows the <a href="https://www.atsdr.cdc.gov/placeandhealth/svi/data_documentation_download.html" class="external-link">CDC/ATSDR
SVI documentation</a> strictly, where SVI variables starting with “EP_”
(percent estimate) are sometimes obtained directly from Census, while in
other cases are values computed from Census variables.</p>
<p>For example, in the variable table below for 2020, the calculation
field (the last column) for <code>EP_UNEMP</code> is a Census variable
and a calculation formula for <code>EP_POV150</code>. As a result,
<code>DP03_0009PE</code> from Census is directly used as
<code>EP_UNEMP</code>, whereas <code>S1701_C01_001E</code> is obtained
from Census and used to calculate <code>EP_POV150</code> (along with
<code>E_POV150</code>).</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">variable_e_ep_calculation_2020</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="op">!</span><span class="va">theme</span> <span class="op">==</span> <span class="fl">5</span>, </span>
<span>    <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_starts.html" class="external-link">str_starts</a></span><span class="op">(</span><span class="va">x2020_variable_name</span>, <span class="st">"EP_"</span><span class="op">)</span></span>
<span>    <span class="op">)</span> </span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 16 × 3</span></span></span>
<span><span class="co">#&gt;    x2020_variable_name theme x2020_table_field_calculation   </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> EP_POV150               1 (E_POV150 /S1701_C01_001E) * 100</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> EP_UNEMP                1 DP03_0009PE                     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> EP_HBURD                1 (E_HBURD /S2503_C01_001E) *100  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> EP_NOHSDP               1 S0601_C01_033E                  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> EP_UNINSUR              1 S2701_C05_001E                  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> EP_AGE65                2 S0101_C02_030E                  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> EP_AGE17                2 (E_AGE17 /E_TOTPOP) * 100       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> EP_DISABL               2 DP02_0072PE                     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> EP_SNGPNT               2 (E_SNGPNT/E_HH) *100            </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> EP_LIMENG               2 (E_LIMENG /B16005_001E) * 100   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span> EP_MINRTY               3 (E_MINRTY /E_TOTPOP) * 100      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span> EP_MUNIT                4 (E_MUNIT / E_HU) *100           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span> EP_MOBILE               4 DP04_0014PE                     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span> EP_CROWD                4 (E_CROWD /DP04_0002E) * 100     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">15</span> EP_NOVEH                4 DP04_0058PE                     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">16</span> EP_GROUPQ               4 (E_GROUPQ /E_TOTPOP) * 100</span></span></code></pre></div>
<p>However, for aggregation purposes, percent estimates cannot be summed
up directly to a larger geographic level. Instead, we need to use summed
“E_” SVI variables (count estimate) and the corresponding “total” count
to calculate the CZ-level percent. Therefore, we need to modify
variables like <code>DP03_0009PE</code> for <code>EP_UNEMP</code> so
that the calculation field for all “EP_” variables are formula with
explicitly defined denominator (total counts). For example:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">variable_cal_exp_2020</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="op">!</span><span class="va">theme</span> <span class="op">==</span> <span class="fl">5</span>, </span>
<span>    <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_starts.html" class="external-link">str_starts</a></span><span class="op">(</span><span class="va">x2020_variable_name</span>, <span class="st">"EP_"</span><span class="op">)</span></span>
<span>    <span class="op">)</span> </span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 16 × 3</span></span></span>
<span><span class="co">#&gt;    x2020_variable_name theme x2020_table_field_calculation    </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                            </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> EP_POV150               1 (E_POV150 /S1701_C01_001E) * 100 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> EP_UNEMP                1 (E_UNEMP /DP03_0003E) * 100      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> EP_HBURD                1 (E_HBURD /S2503_C01_001E) *100   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> EP_NOHSDP               1 (E_NOHSDP /B06009_001E) * 100    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> EP_UNINSUR              1 (E_UNINSUR /S2701_C01_001E) * 100</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> EP_AGE65                2 (E_AGE65 /E_TOTPOP) * 100        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> EP_AGE17                2 (E_AGE17 /E_TOTPOP) * 100        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> EP_DISABL               2 (E_DISABL /S2701_C01_001E) * 100 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> EP_SNGPNT               2 (E_SNGPNT/E_HH) *100             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> EP_LIMENG               2 (E_LIMENG /B16005_001E) * 100    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span> EP_MINRTY               3 (E_MINRTY /E_TOTPOP) * 100       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span> EP_MUNIT                4 (E_MUNIT / E_HU) *100            </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span> EP_MOBILE               4 (E_MOBILE /DP04_0001E) * 100     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span> EP_CROWD                4 (E_CROWD /DP04_0002E) * 100      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">15</span> EP_NOVEH                4 (E_NOVEH /DP04_0002E) * 100      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">16</span> EP_GROUPQ               4 (E_GROUPQ /E_TOTPOP) * 100</span></span></code></pre></div>
<p>To integrate the modified variable lists to
<code><a href="../reference/get_census_data.html">get_census_data()</a></code>, we introduce another argument
<code>exp</code>, where we can specify which of the two variables list
is used:</p>
<ul>
<li><p>(Default) <code>exp = FALSE</code>: use variables following
CDC/ATSDR documentation.</p></li>
<li><p><code>exp = TRUE</code>: use variables with explicitly defined
denominator.</p></li>
</ul>
<p>For use with <code><a href="../reference/get_svi_x.html">get_svi_x()</a></code>, <code>exp = TRUE</code> is
recommended.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Heli Xu, Ran Li, Usama Bilal.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
